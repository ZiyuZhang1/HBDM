# Enhancing Target Discovery in Coronary Artery Disease through Graph Embedding: Hierarchical Block Distance Model (HBDM)

Python 3.7.0 and Pytorch 2.0.0 implementation of the Hierarchical Block Distance Model (HBDM).

## Description

The project extends the Hierarchical Block Distance Model (HBDM) [GitHub](https://github.com/nicknakis/hbdm) framework to weighted networks, comparing its performance with the traditional shortest path method. Results indicate that HBDM demonstrates superior performance in both link prediction and node classification, remaining robust irrespective of the presence or absence of edge weights. This highlights the applicability of HBDM, particularly in scenarios where network weight information is unavailable. The study further explores the biological significance of the hierarchy generated by HBDM, revealing meaningful biological relevance. 

Here, we present a practical application where HBDM is employed to uncover genes related to CAD in co-expression networks, highlighting the model's potential to advance our comprehension of complex diseases within biological networks.


##  Pipeline overview
| <img src="https://github.com/ZiyuZhang1/HBDM/blob/local/img/pipeline.png?raw=true" />   |
Construct a gene co-expression network from expression data and then use HBDM to discover CAD-related genes and modules.



## Installation

### Create a Python 3.7.0 environment with conda

```
conda create -n ${env_name} python=3.7.0  
```

### Activate the environment

```
conda activate ${env_name} 
```

### Please install the required packages
```pip install -r requirements.txt```

### Additional packages

Our Pytorch implementation uses the [pytorch_sparse](https://github.com/rusty1s/pytorch_sparse) package. Installation guidelines can be found at the corresponding [Github repository](https://github.com/rusty1s/pytorch_sparse).

#### For a cpu installation please use: 

```pip install torch-scatter torch-sparse -f https://data.pyg.org/whl/torch-1.12.1+cpu.html```

#### For a gpu installation please use:

```pip install torch-scatter torch-sparse -f https://data.pyg.org/whl/torch-1.12.1+${CUDA}.html```

where ${CUDA} should be replaced by either cu102, cu113, or cu116 depending on your PyTorch installation.

### Construct cell-specific network from scRNA expression data
**RUN:** &emsp; ```data_process_code/sc_process.py```
### Learning hierarchical and multi-scale graph representations with HBDM
**RUN:** &emsp; ```python main.py```

optional arguments:

**--epochs**  &emsp;  number of epochs for training (default: 5K)

**--RH**    &emsp;    number of epochs to rebuild the hierarchy from scratch (default: 25)

**--cuda**  &emsp;    CUDA training (default: True)

**--LP**   &emsp;     performs link prediction (default: True)

**--D**   &emsp;      dimensionality of the embeddings (default: 8)

**--lr**   &emsp;     learning rate for the ADAM optimizer (default: 0.1)

**--RE**   &emsp;     activates random effects (default: True)

**--W**   &emsp;     binary network or int-weight network (default: 1)

**--dataset** &emsp;  dataset to apply HBDM 

### CUDA Implementation

The code has been primarily constructed and optimized for running in a GPU-enabled environment.

### Disease-related gene priortize and gene set enrichment analysis
**RUN:** &emsp; ```results_analysis_code\sc_network_analysis.ipynb```

### References
N. Nakis, A. Celikkanat, S. Lehmann and M. MÃ¸rup, [A Hierarchical Block Distance Model for Ultra Low-Dimensional Graph Representations](https://arxiv.org/abs/2204.05885), Preprint.

